name: Generate Profile Metrics

on:
  schedule: # ë§¤ì¼ ìë™ ì‹¤í–‰
    - cron: "0 */24 * * *"
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©
  push: # main ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œ ì‹¤í–‰
    branches:
    - main

jobs:
  generate:
    permissions:
      contents: write # íŒŒì¼ ì“°ê¸° ê¶Œí•œ
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      # ğŸŒŸ [ì¶”ê°€] 1. GitHub Stats ë° Top Languages ì¹´ë“œ ìƒì„±
      - name: Generate GitHub Stats and Top Languages
        # metrics Actionì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        uses: lowlighter/metrics@latest
        with:
          # STATS_PAT Secretì„ ì‚¬ìš©í•˜ì—¬ API Rate Limit ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
          token: ${{ secrets.STATS_PAT }} 
          
          # output ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ì´ë¦„ ì„¤ì •
          output_path: output
          
          # ìƒì„±í•  í”ŒëŸ¬ê·¸ì¸ ì„¤ì • (Stats, Top Languages)
          plugin_github_stats: yes
          plugin_languages: yes
          
          # ì¹´ë“œ ìŠ¤íƒ€ì¼ ì„¤ì • (README.mdì˜ í…Œë§ˆì™€ ì¼ì¹˜ì‹œí‚¤ì„¸ìš”)
          plugin_github_stats_theme: radical
          plugin_languages_theme: radical
          
          # ê¸°íƒ€ ì„¤ì •
          commits_authoring: ${{ github.repository_owner }}
          base_branch: output

      # ğŸŒŸ [ê¸°ì¡´ Pacman] 2. Pacman ê·¸ë˜í”„ ìƒì„±
      - name: Generate Pacman Contribution Graph
        uses: abozanona/pacman-contribution-graph@main
        with:
          github_user_name: ${{ github.repository_owner }}
          
      # ğŸŒŸ [í‘¸ì‹œ] 3. ìƒì„±ëœ íŒŒì¼ë“¤ì„ output ë¸Œëœì¹˜ë¡œ í‘¸ì‹œ
      # (metrics Actionì€ output ê²½ë¡œì—, pacman Actionì€ dist ê²½ë¡œì— ì¶œë ¥í•©ë‹ˆë‹¤.)
      - name: Push generated files to the output branch
        uses: crazy-max/ghaction-github-pages@v3.1.0
        with:
          target_branch: output
          # outputê³¼ dist ë””ë ‰í† ë¦¬ë¥¼ ëª¨ë‘ í¬í•¨í•˜ë„ë¡ ì„¤ì • (GitHub Pages Actionì˜ ê¸°ëŠ¥)
          build_dir: .
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
