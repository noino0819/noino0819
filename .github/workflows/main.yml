name: Generate Profile Metrics & Pacman

on:
  schedule: # ë§¤ì¼ ìë™ ì‹¤í–‰
    - cron: "0 0 * * *"  # ë§¤ì¼ 00:00 UTCì— ì‹¤í–‰
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©
  push:
    branches:
    - main

jobs:
  generate:
    permissions:
      contents: write 
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      # ğŸŒŸ [ìˆ˜ì •] 1. Metrics Action (Stats ë° Languages í†µí•©) ì‹¤í–‰
      # ì´ Actionì€ í† í°ì„ ì‚¬ìš©í•˜ì—¬ í†µê³„ë¥¼ ìƒì„±í•˜ê³ , .github/metrics.svgì— ì €ì¥í•©ë‹ˆë‹¤.
      - name: Generate Combined Metrics Card
        uses: lowlighter/metrics@latest
        with:
          # STATS_PAT Secret ì‚¬ìš© (API Rate Limit ë¬¸ì œ í•´ê²°)
          token: ${{ secrets.STATS_PAT }} 
          
          # ì¶œë ¥ íŒŒì¼ëª… ì§€ì •
          filename: metrics.svg 
          
          # ì‚¬ìš©í•  í”ŒëŸ¬ê·¸ì¸ê³¼ ìŠ¤íƒ€ì¼ ì„¤ì •
          plugin_languages: yes
          plugin_github_stats: yes
          
          # README.mdì—ì„œ ì‚¬ìš©í•˜ë˜ radical í…Œë§ˆì™€ ìœ ì‚¬í•œ ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.
          plugin_languages_limit: 8
          plugin_languages_threshold: 0%
          plugin_languages_ignored: javascript, html, css # ì˜ˆì‹œ: ì›ì¹˜ ì•ŠëŠ” ì–¸ì–´ ì œì™¸ ê°€ëŠ¥
          config_display: columns
          config_scale: 1.2
          
          # GitHub Statsì™€ Languagesë¥¼ ëª¨ë‘ í¬í•¨í•˜ëŠ” ì„¤ì •ì…ë‹ˆë‹¤.
          plugin_config_colors: github # GitHub ê¸°ë³¸ ìƒ‰ìƒ ì‚¬ìš©
          
          # Actionì€ ê¸°ë³¸ì ìœ¼ë¡œ main ë¸Œëœì¹˜ì— ì»¤ë°‹í•˜ë¯€ë¡œ, ë³„ë„ push stepì€ ì œê±°í•©ë‹ˆë‹¤.


      # 2. Pacman ê·¸ë˜í”„ ìƒì„± (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
      # Pacman Actionì€ ì—¬ì „íˆ dist ê²½ë¡œì— SVGë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      - name: Generate Pacman Contribution Graph
        uses: abozanona/pacman-contribution-graph@main
        with:
          github_user_name: ${{ github.repository_owner }}

      # 3. Pacman SVGë¥¼ output ë¸Œëœì¹˜ë¡œ í‘¸ì‹œ (MetricsëŠ” main ë¸Œëœì¹˜ì— ì»¤ë°‹)
      - name: Push Pacman SVG to the output branch
        uses: crazy-max/ghaction-github-pages@v3.1.0
        with:
          target_branch: output
          build_dir: dist # Pacmanì´ distì— ì €ì¥í•˜ë¯€ë¡œ distë§Œ í‘¸ì‹œ
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
